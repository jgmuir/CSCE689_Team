import csv
import os
import requests

# Set the path to the local CSV file to read
filename = "../resources/full_sha256.txt"

# Set the directory to save the downloaded files
output_dir = "malware_samples"

# Create the output directory if it doesn't exist
if not os.path.exists(output_dir):
    os.makedirs(output_dir)

# Open the CSV file and parse its contents
with open(filename, 'r') as file:
    sha256_hash = [line.strip() for line in file]
        
    # Build the download URL for the file using the SHA256 hash
    download_url = f"https://bazaar.abuse.ch/download/{sha256_hash}/"
    print(download_url)
    
    # Set the path to save the downloaded file
    output_path = os.path.join(output_dir, sha256_hash)
    
    # Download the file and save it to the output directory
    response = requests.get(download_url)
    with open(output_path, "wb") as f:
        f.write(response.content)