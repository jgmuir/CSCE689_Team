import csv
import os
import requests

# Set the path to the local CSV file to read
csv_path = "malware_full_list.csv"

# Set the directory to save the downloaded files
output_dir = "malware_samples"

# Create the output directory if it doesn't exist
if not os.path.exists(output_dir):
    os.makedirs(output_dir)

# Open the CSV file and parse its contents
with open(csv_path, "r") as f:
    reader = csv.DictReader(f)

    # Loop through each row of the CSV and download the corresponding file
    for row in reader:
        # Get the SHA256 hash from the current row
        sha256_hash = row["sha256_hash"]
        
        sha256_hash = sha256_hash.replace(" ", "").replace('"', '')
        
        # Build the download URL for the file using the SHA256 hash
        download_url = f"https://bazaar.abuse.ch/download/{sha256_hash}/"
        print(download_url)
        
        # Set the path to save the downloaded file
        output_path = os.path.join(output_dir, sha256_hash)
        
        # Download the file and save it to the output directory
        response = requests.get(download_url)
        with open(output_path, "wb") as f:
            f.write(response.content)